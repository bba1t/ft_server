
#### –≠–≤–æ–ª—é—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PHP:

**FastCGI** - —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (Nginx) —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ (PHP, Python, etc).

1. **CGI** (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π): –î–ª—è –ö–ê–ñ–î–û–ì–û –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ù–û–í–´–ô –ø—Ä–æ—Ü–µ—Å—Å PHP ‚Üí –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ
2. **FastCGI**: PHP –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ ‚Üí –±—ã—Å—Ç—Ä–æ
3. **PHP-FPM**: –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä FastCGI –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

#### –ß—Ç–æ —Ç–∞–∫–æ–µ PHP-FPM?

PHP-FPM (PHP FastCGI Process Manager) - —ç—Ç–æ –¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π:
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—É–ª PHP-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ
- ‚úÖ –£–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º–∏ (–∑–∞–ø—É—Å–∫–∞–µ—Ç/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ)
- ‚úÖ –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —É–ø–∞–≤—à–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã)
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PHP-FPM:
```
Nginx (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä) ‚ÜêFastCGI‚Üí PHP-FPM (–º–µ–Ω–µ–¥–∂–µ—Ä) ‚Üê‚Üí PHP –ø—Ä–æ—Ü–µ—Å—Å—ã (–≤–æ—Ä–∫–µ—Ä—ã)
     ‚Üë                          ‚Üë                       ‚Üë
  –ü—Ä–∏–Ω–∏–º–∞–µ—Ç                  –£–ø—Ä–∞–≤–ª—è–µ—Ç              –í—ã–ø–æ–ª–Ω—è—é—Ç
  –∑–∞–ø—Ä–æ—Å—ã                   –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏             PHP-–∫–æ–¥
```

#### –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–∫–µ—Ç (socket)?

[–í–µ–±-—Å–æ–∫–µ—Ç (WebSocket)](https://www.youtube.com/watch?v=19d4AXt3dSI) ‚Äî —ç—Ç–æ¬†–ø—Ä–æ—Ç–æ–∫–æ–ª, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º (–±—Ä–∞—É–∑–µ—Ä–æ–º) –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç HTTP, –≥–¥–µ –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –∏ –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥—É –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.

–¢–∏–ø—ã —Å–æ–∫–µ—Ç–æ–≤:
1. **TCP-—Å–æ–∫–µ—Ç** (—Å–µ—Ç–µ–≤–æ–π): `127.0.0.1:9000`
   - –û–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - –ö–∞–∫ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –º–µ–∂–¥—É –¥–≤—É–º—è –æ—Ñ–∏—Å–∞–º–∏

2. **Unix-—Å–æ–∫–µ—Ç** (—Ñ–∞–π–ª–æ–≤—ã–π): `/var/run/php/php7.3-fpm.sock`
   - –û–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
   - –ö–∞–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä –≤ –æ–¥–Ω–æ–º –æ—Ñ–∏—Å–µ (–±—ã—Å—Ç—Ä–µ–µ!)

–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ Unix-—Å–æ–∫–µ—Ç?
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ**: –ù–µ –Ω—É–∂–Ω–æ —Å–µ—Ç–µ–≤–æ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ**: –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–µ–µ**: –ú–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞


–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ¬†`php-fpm7.3`¬†**–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬†—Å–æ–∑–¥–∞–µ—Ç —Å–æ–∫–µ—Ç –∏ –ø–∏–¥:**
- `/run/php/php7.3-fpm.sock`¬†(—Å–æ–∫–µ—Ç)
- `/run/php/php7.3-fpm.pid`¬†(PID-—Ñ–∞–π–ª)
- –ù–æ –ø–∞–ø–∫—É `/run/php/` –∏–ª–∏ `/var/run/php/` –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —Å–∞–º–æ–º—É

#### –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –±–ª–æ–∫–∞ location

```nginx
location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/var/run/php/php7.3-fpm.sock;
    include fastcgi_params;
}
```

---

```nginx
location ~ \.php$ {
```
- **`~`** - –æ–∑–Ω–∞—á–∞–µ—Ç "—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ"
- **`\.php$`** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: "–≤—Å–µ URL, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ .php"
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≠—Ç–æ—Ç –±–ª–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï PHP-—Ñ–∞–π–ª—ã

---

```nginx
include snippets/fastcgi-php.conf;
```
–ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ FastCGI

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `/etc/nginx/snippets/fastcgi-php.conf`:
```nginx
# –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
try_files $uri =404;

# FastCGI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
fastcgi_split_path_info ^(.+\.php)(/.+)$;
fastcgi_index index.php;

# –ë–∞–∑–æ–≤—ã–µ FastCGI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
include fastcgi_params;
```

–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ: –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!

---

```nginx
fastcgi_pass unix:/run/php/php7.3-fpm.sock;
```
**–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —Å—Ç—Ä–æ–∫–∞!** –û–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç Nginx: "–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å PHP-–∑–∞–ø—Ä–æ—Å—ã"

- `fastcgi_pass` - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è FastCGI —Å–µ—Ä–≤–µ—Ä–∞
- `unix:` - —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º Unix-—Å–æ–∫–µ—Ç (–∞ –Ω–µ TCP)
- `/var/run/php/php7.3-fpm.sock` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É-—Å–æ–∫–µ—Ç—É

–ß—Ç–æ —Ç–∞–∫–æ–µ `/var/run/php/php7.3-fpm.sock`:
- –≠—Ç–æ –Ω–µ –æ–±—ã—á–Ω—ã–π —Ñ–∞–π–ª, –∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª-—Å–æ–∫–µ—Ç
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ PHP-FPM
- –ò—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ PHP-FPM
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ fastcgi-php.conf
```nginx
include fastcgi_params;
```
**–ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª:** `/etc/nginx/fastcgi_params`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã FastCGI:
```nginx
fastcgi_param  QUERY_STRING       $query_string;
fastcgi_param  REQUEST_METHOD     $request_method;
fastcgi_param  CONTENT_TYPE       $content_type;
fastcgi_param  CONTENT_LENGTH     $content_length;
# ... –∏ –µ—â–µ 20+ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

#### –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ PHP-–∑–∞–ø—Ä–æ—Å–∞

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç: `http://site.com/admin/page.php`
2. **Nginx** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç: "URL –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `.php`" ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–∞—à `location`
3. **Nginx** –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å: `/var/www/html/admin/page.php`
4. **Nginx** —Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å —Å–æ–∫–µ—Ç–æ–º: `/var/run/php/php7.3-fpm.sock`
5. **Nginx** –ø–µ—Ä–µ–¥–∞–µ—Ç —á–µ—Ä–µ–∑ FastCGI: "–í—ã–ø–æ–ª–Ω–∏ `/var/www/html/admin/page.php`"
6. **PHP-FPM** –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –Ω–∞—Ö–æ–¥–∏—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π PHP-–ø—Ä–æ—Ü–µ—Å—Å
7. **PHP-–ø—Ä–æ—Ü–µ—Å—Å** –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
8. **Nginx** –ø–æ–ª—É—á–∞–µ—Ç HTML –∏ –æ—Ç–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é




#### **–†–µ—à–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞**

- –†–∞–∑–º–µ—â–∞—Ç—å php —Ñ–∞–π–ª—ã –±—É–¥—É –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –≤–µ–±-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: `/var/www/html/`
- –ò –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é –¥–ª—è php –∫–æ–Ω—Ñ–∏–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:¬†`/etc/nginx/sites-available/default`, –¥–æ–±–∞–≤–∏–≤ –±–ª–æ–∫¬†`location`¬†–≤–Ω—É—Ç—Ä–∏¬†`server`
- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è php –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `/run/php/` –¥–ª—è —Å–æ–∫–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ PHP-FMP
- –ü—Ä–æ–≤–µ—Ä–∫–∞:
	- `http://localhost/info.php` - –ø–æ–∫–∞–∂–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ PHP
	- `http://localhost/time.php` - –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
	- `http://localhost//index.php` - –ø–æ–∫–∞–∂–µ—Ç "Hello PHP World!"

```dockerfile
FROM debian:buster

# –ó–∞–º–µ–Ω—è—é sources.list –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–ª—è –∞—Ä—Ö–∏–≤–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
RUN echo "deb http://archive.debian.org/debian/ buster main" > /etc/apt/sources.list && \
    echo "deb http://archive.debian.org/debian-security buster/updates main" >> /etc/apt/sources.list

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Nginx, PHP –∏ PHP-FPM
RUN apt-get update && apt-get install -y \
    nginx php php-fpm php-mysql php-cli php-common

# –ü–∞–ø–∫–∞ –¥–ª—è PHP-FPM —Å–æ–∫–µ—Ç–∞, –∏–ª–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å /var/run/php/
RUN mkdir -p /run/php/
RUN echo "<?php phpinfo(); ?>" > /var/www/html/info.php
RUN echo "<?php echo '<h1>Hello PHP World!</h1>'; ?>" > /var/www/html/index.php
RUN echo "<?php echo 'Current time: ' . date('Y-m-d H:i:s'); ?>" > /var/www/html/time.php

# üìÑ –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú NGINX –î–õ–Ø –†–ê–ë–û–¢–´ –° PHP
RUN cat <<EOF > /etc/nginx/sites-available/default
server {
    listen 80;
    server_name _;
    root /var/www/html;          # üéØ –ö–û–†–ù–ï–í–ê–Ø –î–ò–†–ï–ö–¢–û–†–ò–Ø –î–õ–Ø PHP-–§–ê–ô–õ–û–í
    index index.php index.html index.htm;

    # üêò –û–ë–†–ê–ë–û–¢–ö–ê PHP-–§–ê–ô–õ–û–í - –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;    # üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FastCGI
        fastcgi_pass unix:/run/php/php7.3-fpm.sock;  # üîÑ –ü–µ—Ä–µ–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É PHP-FPM —Å–æ–∫–µ—Ç—É, –∏–ª–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å /var/run/php/
        include fastcgi_params; # üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    }

    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOF

# üîó –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–∞–π—Ç
RUN ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/

# üìã –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
COPY start.sh /start.sh
RUN chmod +x /start.sh

CMD ["./start.sh"]
```

```bash
#!/bin/bash
# start.sh

echo "üöÄ Starting PHP-FPM..."
# üéØ –ó–ê–ü–£–°–ö–ê–ï–ú PHP-FPM –í –§–û–ù–û–í–û–ú –†–ï–ñ–ò–ú–ï
php-fpm7.3 --daemonize

echo "üöÄ Starting Nginx..."
# üéØ –ó–ê–ü–£–°–ö–ê–ï–ú NGINX –í FOREGROUND (–û–°–ù–û–í–ù–û–ô –ü–†–û–¶–ï–°–°)
nginx -g 'daemon off;'
```

